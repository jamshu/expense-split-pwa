import"../chunks/DsnmJJEf.js";import{i as oe}from"../chunks/DrKcwzaR.js";import{o as ve,e as ue,s as A}from"../chunks/f-szSqCg.js";import{ah as J,ai as ce,aj as Y,a7 as de,ak as fe,al as Z,am as _e,v as he,an as ee,h as ae,k as S,ao as me,q as G,O as pe,J as P,D as ge,K as E,Q as p,y as t,I as D,P as be,$ as ye,S as h,T as c,V as y,R as m,ap as xe,aq as ke}from"../chunks/DNUg-ClE.js";import{i as Se}from"../chunks/XBurfDTB.js";import{e as H,o as q,i as N,s as Ee}from"../chunks/fI2x7jVh.js";import{r as C}from"../chunks/BOJn4yNK.js";function re(e,l,s=!1){if(e.multiple){if(l==null)return;if(!de(l))return fe();for(var n of e.options)n.selected=l.includes(w(n));return}for(n of e.options){var a=w(n);if(Z(a,l)){n.selected=!0;return}}(!s||l!==void 0)&&(e.selectedIndex=-1)}function qe(e){var l=new MutationObserver(()=>{re(e,e.__value)});l.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Y(()=>{l.disconnect()})}function we(e,l,s=l){var n=!0;J(e,"change",a=>{var i=a?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(i),w);else{var d=e.querySelector(i)??e.querySelector("option:not([disabled])");o=d&&w(d)}s(o)}),ce(()=>{var a=l();if(re(e,a,n),n&&a===void 0){var i=e.querySelector(":checked");i!==null&&(a=w(i),s(a))}e.__value=a,n=!1}),qe(e)}function w(e){return"__value"in e?e.__value:e.value}function U(e,l,s=l){var n=new WeakSet;J(e,"input",async a=>{var i=a?e.defaultValue:e.value;if(i=j(e)?B(i):i,s(i),S!==null&&n.add(S),await _e(),i!==(i=l())){var o=e.selectionStart,d=e.selectionEnd,f=e.value.length;if(e.value=i??"",d!==null){var r=e.value.length;o===d&&d===f&&r>f?(e.selectionStart=r,e.selectionEnd=r):(e.selectionStart=o,e.selectionEnd=Math.min(d,r))}}}),(ae&&e.defaultValue!==e.value||he(l)==null&&e.value)&&(s(j(e)?B(e.value):e.value),S!==null&&n.add(S)),ee(()=>{var a=l();if(e===document.activeElement){var i=me??S;if(n.has(i))return}j(e)&&a===B(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}const R=new Set;function Ae(e,l,s,n,a=n){var i=s.getAttribute("type")==="checkbox",o=e;let d=!1;if(l!==null)for(var f of l)o=o[f]??=[];o.push(s),J(s,"change",()=>{var r=s.__value;i&&(r=X(o,r,s.checked)),a(r)},()=>a(i?[]:null)),ee(()=>{var r=n();if(ae&&s.defaultChecked!==s.checked){d=!0;return}i?(r=r||[],s.checked=r.includes(s.__value)):s.checked=Z(s.__value,r)}),Y(()=>{var r=o.indexOf(s);r!==-1&&o.splice(r,1)}),R.has(o)||(R.add(o),G(()=>{o.sort((r,x)=>r.compareDocumentPosition(x)===4?-1:1),R.delete(o)})),G(()=>{if(d){var r;if(i)r=X(o,r,s.checked);else{var x=o.find(k=>k.checked);r=x?.__value}a(r)}})}function X(e,l,s){for(var n=new Set,a=0;a<e.length;a+=1)e[a].checked&&n.add(e[a].__value);return s||n.delete(l),Array.from(n)}function j(e){var l=e.type;return l==="number"||l==="range"}function B(e){return e===""?null:+e}function De(e){return function(...l){var s=l[0];return s.preventDefault(),e?.apply(this,l)}}var Pe=P("<option> </option>"),$e=P('<label class="checkbox-item svelte-1uha8ag"><input type="checkbox" class="svelte-1uha8ag"/> </label>'),Me=P("<div> </div>"),Fe=P('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">💰 Expense Split</h1> <nav class="svelte-1uha8ag"><a href="/" class="active svelte-1uha8ag">Add Expense</a> <a href="/balance" class="svelte-1uha8ag">Balance Report</a></nav> <form class="svelte-1uha8ag"><div class="form-group svelte-1uha8ag"><label for="description" class="svelte-1uha8ag">Description</label> <input type="text" id="description" placeholder="e.g., Weekly groceries" required class="svelte-1uha8ag"/></div> <div class="form-group svelte-1uha8ag"><label for="amount" class="svelte-1uha8ag">Amount</label> <input type="number" id="amount" placeholder="0.00" step="0.01" min="0" required class="svelte-1uha8ag"/></div> <div class="form-group svelte-1uha8ag"><label for="payer" class="svelte-1uha8ag">Who Paid?</label> <select id="payer" required class="svelte-1uha8ag"><option>-- Select payer --</option><!></select></div> <div class="form-group svelte-1uha8ag"><label class="svelte-1uha8ag">Participants</label> <div class="checkbox-grid svelte-1uha8ag"></div> <small class="svelte-1uha8ag">Tick participants who share this expense</small></div> <!> <button type="submit" class="svelte-1uha8ag"> </button></form></div>');function je(e,l){pe(l,!1);const s=[];let n=y(""),a=y(""),i=y(""),o=y([]),d=y(!1),f=y(""),r=y([]);ve(async()=>{try{c(r,await q.fetchDefaultParticipants()),(!t(r)||t(r).length===0)&&c(r,await q.fetchPartners())}catch(v){console.error("Failed to load partners",v)}});async function x(){if(!t(n)||!t(a)||!t(i)||t(o).length===0){c(f,"⚠️ Please fill all fields");return}c(d,!0),c(f,"");try{const v={x_name:t(n),x_studio_value:parseFloat(t(a)),x_studio_who_paid:q.formatMany2one(t(i))},u=q.formatMany2many(t(o));u.length&&(v.x_studio_participants=u),v.x_studio_date=new Date().toISOString().split("T")[0],await q.createExpense(v),c(f,"✅ Expense added successfully!"),c(n,""),c(a,""),c(i,""),c(o,[])}catch(v){c(f,`❌ Error: ${v.message}`)}finally{c(d,!1)}}oe();var k=Fe();ge(v=>{ye.title="Expense Split - Add Expense"});var $=h(p(k),4),M=p($),K=h(p(M),2);C(K),m(M);var F=h(M,2),L=h(p(F),2);C(L),m(F);var O=h(F,2),I=h(p(O),2);E(()=>{t(i),xe(()=>{t(r)})});var T=p(I);T.value=T.__value="";var te=h(T);H(te,1,()=>t(r),N,(v,u)=>{var _=Pe(),g=p(_,!0);m(_);var b={};E(()=>{A(g,t(u).display_name),b!==(b=t(u).id)&&(_.value=(_.__value=t(u).id)??"")}),D(v,_)}),m(I),m(O);var V=h(O,2),Q=h(p(V),2);H(Q,5,()=>t(r),N,(v,u)=>{var _=$e(),g=p(_);C(g);var b,ie=h(g);m(_),E(()=>{b!==(b=t(u).id)&&(g.value=(g.__value=t(u).id)??""),A(ie,` ${t(u).display_name??""}`)}),Ae(s,[],g,()=>(t(u).id,t(o)),ne=>c(o,ne)),D(v,_)}),m(Q),ke(2),m(V);var z=h(V,2);{var le=v=>{var u=Me();let _;var g=p(u,!0);m(u),E(b=>{_=Ee(u,1,"message svelte-1uha8ag",null,_,b),A(g,t(f))},[()=>({error:t(f).includes("❌")})]),D(v,u)};Se(z,v=>{t(f)&&v(le)})}var W=h(z,2),se=p(W,!0);m(W),m($),m(k),E(()=>{W.disabled=t(d),A(se,t(d)?"⏳ Adding...":"➕ Add Expense")}),U(K,()=>t(n),v=>c(n,v)),U(L,()=>t(a),v=>c(a,v)),we(I,()=>t(i),v=>c(i,v)),ue("submit",$,De(x)),D(e,k),be()}export{je as component};
