import"../chunks/DsnmJJEf.js";import{i as he}from"../chunks/DrKcwzaR.js";import{o as ye,s as A}from"../chunks/f-szSqCg.js";import{O as xe,J as f,D as we,I as v,P as be,$ as Se,T as Q,V,y as e,S as x,Q as i,R as t,C as se,F as $,K as q,W as Ae,X as Ne}from"../chunks/DNUg-ClE.js";import{i as D}from"../chunks/XBurfDTB.js";import{o as re,e as ee,s as ne,i as te}from"../chunks/C-dA0ecG.js";function Ee(s){if(s==null)return"";if(Array.isArray(s)&&s.length>=2)return String(s[1]);if(typeof s=="object"){if(s.display_name)return String(s.display_name);if(s.name)return String(s.name)}return String(s)}function Pe(s){if(!s)return[];if(typeof s=="string")return s.split(",").map(r=>r.trim()).filter(Boolean);if(Array.isArray(s)){const r=[];for(const a of s)Array.isArray(a)&&a.length>=2?r.push(String(a[1])):a&&typeof a=="object"?a.display_name?r.push(String(a.display_name)):a.name?r.push(String(a.name)):a.id&&r.push(String(a.id)):a!=null&&r.push(String(a));return r.filter(Boolean)}return[String(s)]}function je(s){const r={};for(const a of s){const F=a.x_studio_who_paid,g=parseFloat(String(a.x_studio_value||0)),w=Ee(F),u=Pe(a.x_studio_participants);if(!w||u.length===0||g<=0)continue;r[w]||(r[w]=0),u.forEach(b=>{r[b]||(r[b]=0)}),r[w]+=g;const m=g/u.length;u.forEach(b=>{r[b]-=m})}return r}function Be(s){const r=[],a=[];for(const[u,m]of Object.entries(s))m>.01?r.push({person:u,amount:m}):m<-.01&&a.push({person:u,amount:-m});const F=[];let g=0,w=0;for(;g<r.length&&w<a.length;){const u=r[g],m=a[w],b=Math.min(u.amount,m.amount);F.push({from:m.person,to:u.person,amount:parseFloat(b.toFixed(2))}),u.amount-=b,m.amount-=b,u.amount<.01&&g++,m.amount<.01&&w++}return F}var Fe=f('<div class="loading svelte-wl9gn7">⏳ Loading...</div>'),Me=f('<div class="error-box svelte-wl9gn7"> </div>'),Oe=f('<p class="empty svelte-wl9gn7">No expenses recorded yet.</p>'),Re=f('<span class="badge green svelte-wl9gn7">owed</span>'),Ie=f('<span class="badge red svelte-wl9gn7">owes</span>'),ze=f('<span class="badge gray svelte-wl9gn7">settled</span>'),Ce=f('<div><span class="person svelte-wl9gn7"> </span> <span> <!></span></div>'),ke=f('<div class="balance-list svelte-wl9gn7"></div>'),De=f('<p class="empty svelte-wl9gn7">All balanced! No settlements needed.</p>'),Je=f('<div class="settlement-item svelte-wl9gn7"><div class="settlement-text svelte-wl9gn7"><strong> </strong> pays <strong> </strong></div> <div class="settlement-amount svelte-wl9gn7"> </div></div>'),Ue=f('<div class="settlement-list svelte-wl9gn7"></div>'),Ke=f('<p class="empty svelte-wl9gn7">No expenses recorded yet.</p>'),Le=f('<div class="expense-item svelte-wl9gn7"><div class="expense-header svelte-wl9gn7"><span class="expense-type svelte-wl9gn7"> </span> <span class="expense-name svelte-wl9gn7"> </span> <span class="expense-amount svelte-wl9gn7"> </span></div> <div class="expense-details svelte-wl9gn7"><span>Paid by: <strong> </strong></span> <span> </span></div></div>'),Qe=f('<div class="expense-list svelte-wl9gn7"></div>'),Te=f('<div class="report-card svelte-wl9gn7"><h2 class="svelte-wl9gn7">💵 Individual Balances</h2> <!></div> <div class="report-card svelte-wl9gn7"><h2 class="svelte-wl9gn7">🔄 Settlement Plan</h2> <!></div> <div class="report-card svelte-wl9gn7"><h2 class="svelte-wl9gn7">📝 Recent Expenses</h2> <!></div>',1),Ve=f('<div class="container svelte-wl9gn7"><h1 class="svelte-wl9gn7">📊 Balance Report</h1> <nav class="svelte-wl9gn7"><a href="/" class="svelte-wl9gn7">Add Expense</a> <a href="/balance" class="active svelte-wl9gn7">Balance Report</a></nav> <!></div>');function Ze(s,r){xe(r,!1);let a=V(!0),F=V(""),g=V([]),w=V({}),u=V([]);ye(async()=>{try{Q(g,await re.searchExpenses([],["x_name","x_studio_value","x_studio_who_paid","x_studio_participants","x_studio_type","x_studio_date"]));try{const n=new Set;for(const d of e(g)){Array.isArray(d.x_studio_who_paid)&&d.x_studio_who_paid.length>0?n.add(Number(d.x_studio_who_paid[0])):(d.x_studio_who_paid&&typeof d.x_studio_who_paid=="number"||d.x_studio_who_paid&&typeof d.x_studio_who_paid=="string"&&/^\d+$/.test(d.x_studio_who_paid))&&n.add(Number(d.x_studio_who_paid));const J=d.x_studio_participants;if(Array.isArray(J))for(const h of J)Array.isArray(h)&&h.length>0?n.add(Number(h[0])):(typeof h=="number"||typeof h=="string"&&/^\d+$/.test(h))&&n.add(Number(h))}if(n.size>0){const d=Array.from(n),J=await re.searchModel("res.partner",[["id","in",d]],["id","display_name"]),h=new Map(J.map(U=>[Number(U.id),U.display_name]));Q(g,e(g).map(U=>{const o={...U};if(Array.isArray(o.x_studio_who_paid)&&o.x_studio_who_paid.length>0){const _=Number(o.x_studio_who_paid[0]);o.x_studio_who_paid=h.get(_)||String(o.x_studio_who_paid[1]||_)}else if(typeof o.x_studio_who_paid=="number"||typeof o.x_studio_who_paid=="string"&&/^\d+$/.test(o.x_studio_who_paid)){const _=Number(o.x_studio_who_paid);o.x_studio_who_paid=h.get(_)||String(_)}const N=o.x_studio_participants;if(Array.isArray(N)){const _=[];for(const p of N)if(Array.isArray(p)&&p.length>0){const R=Number(p[0]);_.push(h.get(R)||String(p[1]||R))}else if(typeof p=="number"||typeof p=="string"&&/^\d+$/.test(p)){const R=Number(p);_.push(h.get(R)||String(R))}else typeof p=="object"&&p?_.push(String(p.display_name||p.name||p.id||JSON.stringify(p))):_.push(String(p));o.x_studio_participants=_}return o}))}}catch(n){console.warn("Failed to map partner ids to names",n)}Q(w,je(e(g))),Q(u,Be(e(w)))}catch(n){Q(F,n.message)}finally{Q(a,!1)}});function m(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)}he();var b=Ve();we(n=>{Se.title="Expense Split - Balance Report"});var ie=x(i(b),4);{var oe=n=>{var d=Fe();v(n,d)},le=n=>{var d=se(),J=$(d);{var h=o=>{var N=Me(),_=i(N);t(N),q(()=>A(_,`❌ Error: ${e(F)??""}`)),v(o,N)},U=o=>{var N=Te(),_=$(N),p=x(i(_),2);{var R=l=>{var c=Oe();v(l,c)},de=l=>{var c=ke();ee(c,5,()=>Object.entries(e(w)),te,(T,S)=>{var E=Ae(()=>Ne(e(S),2));let j=()=>e(E)[0],y=()=>e(E)[1];var M=Ce();let B;var I=i(M),z=i(I,!0);t(I);var C=x(I,2);let k;var K=i(C),W=x(K);{var H=P=>{var O=Re();v(P,O)},X=P=>{var O=se(),Y=$(O);{var ge=L=>{var Z=Ie();v(L,Z)},me=L=>{var Z=ze();v(L,Z)};D(Y,L=>{y()<0?L(ge):L(me,!1)},!0)}v(P,O)};D(W,P=>{y()>0?P(H):P(X,!1)})}t(C),t(M),q((P,O,Y)=>{B=ne(M,1,"balance-item svelte-wl9gn7",null,B,P),A(z,j()),k=ne(C,1,"amount svelte-wl9gn7",null,k,O),A(K,`${Y??""} `)},[()=>({positive:y()>0,negative:y()<0}),()=>({green:y()>0,red:y()<0}),()=>m(Math.abs(y()))]),v(T,M)}),t(c),v(l,c)};D(p,l=>{Object.keys(e(w)).length===0?l(R):l(de,!1)})}t(_);var G=x(_,2),ve=x(i(G),2);{var _e=l=>{var c=De();v(l,c)},pe=l=>{var c=Ue();ee(c,5,()=>e(u),te,(T,S)=>{var E=Je(),j=i(E),y=i(j),M=i(y,!0);t(y);var B=x(y,2),I=i(B,!0);t(B),t(j);var z=x(j,2),C=i(z,!0);t(z),t(E),q(k=>{A(M,e(S).from),A(I,e(S).to),A(C,k)},[()=>m(e(S).amount)]),v(T,E)}),t(c),v(l,c)};D(ve,l=>{e(u).length===0?l(_e):l(pe,!1)})}t(G);var ae=x(G,2),ce=x(i(ae),2);{var ue=l=>{var c=Ke();v(l,c)},fe=l=>{var c=Qe();ee(c,5,()=>e(g).slice(-10).reverse(),te,(T,S)=>{var E=Le(),j=i(E),y=i(j),M=i(y,!0);t(y);var B=x(y,2),I=i(B,!0);t(B);var z=x(B,2),C=i(z,!0);t(z),t(j);var k=x(j,2),K=i(k),W=x(i(K)),H=i(W,!0);t(W),t(K);var X=x(K,2),P=i(X);t(X),t(k),t(E),q(O=>{A(M,e(S).x_studio_type==="grocery"?"🛒":e(S).x_studio_type==="hotel"?"🏨":"📦"),A(I,e(S).x_name),A(C,O),A(H,e(S).x_studio_who_paid),A(P,`Split: ${e(S).x_studio_participants??""}`)},[()=>m(e(S).x_studio_value)]),v(T,E)}),t(c),v(l,c)};D(ce,l=>{e(g).length===0?l(ue):l(fe,!1)})}t(ae),v(o,N)};D(J,o=>{e(F)?o(h):o(U,!1)},!0)}v(n,d)};D(ie,n=>{e(a)?n(oe):n(le,!1)})}t(b),v(s,b),be()}export{Ze as component};
